<div id="sharepic"
    style="	background-color: #005437;
			background-repeat: no-repeat;
			background-position: 0px 0px; 
			width: 800px; height:800px;
			border:0;
			overflow:hidden;"
    		data-width="800" data-height="800" data-zoom="1" class="selectable" data-cockpit="background">
    <link rel="stylesheet" type="text/css" href="templates/de/styles.css?r=7">

    <div 
        class="draggable selectable" 
        data-cockpit="greentext"  
        onclick="component.select(this)"
        onmousedown="component.startDrag(event)"
        id="greentext"
        spellcheck="false"
        contenteditable="true"
        style="
            left: 120px;
            top: 100px;
            transform: scale(0.8);
        "
    >
        <div class="s sandklee">Tippe Deinen Text</div>
        <div class="m kleesand"style="margin-left:40px;">direkt hier.</div>
        <div class="s sandklee">Verschiebe ihn mit der rechten Maustaste.</div>
    </div>

    <div class="draggable selectable" id="logo" 
        onclick="component.select(this)"
        onmousedown="component.startDrag(event)"
        data-cockpit="logo" data-clipping="true"
        contenteditable="false"
        style="
            width: 400px;
            height: 400px;
            background-image: url('templates/de/logo.svg');
            background-size: contain;
            background-repeat: no-repeat;
            left: -148px;
            top: 359px;
            position: absolute;
        "
    ></div>

    <div id="patterns">

        <div data-id="copyright" data-class="selectable copyright" data-cockpit="copyright" 
            data-max="1" contenteditable="true" spellcheck="false"
            onclick="component.select(this)"
            data-id="copyright"
            style="
                font-size: 14px;
                color: #000000;
            ">Copyright-Hinweis
        </div>

        <div data-id="eyecatcher" data-class="eyecatcher draggable selectable" data-cockpit="eyecatcher"
        data-max="1" spellcheck="false"
        contenteditable="true" oninput="eyecatcher.makeSquare(this);" onclick="component.select(this)"
        onmousedown="component.startDrag(event)" style="
                    z-index:2; 
                    left: 5px; top: 5px; 
                    font-size: 20px; 
                    color: #e9e9e9; 
                    background-color: #0ba1dd;
                    width: 40px; height: 40px;
                "
        >
            <div>
                <p>Text</p>
            </div>
        </div>
    
        <div data-class="addpicture draggable selectable" data-cockpit="addpicture" data-id="addpicture"
        onclick="component.select(this)" onmousedown="component.startDrag(event)" style="
                align-items: center;
                position: absolute;
                left:300px; top:290px;
            ">
        <div class="ap_image" style="
            background-image: url('templates/mint/addpic.jpg');
            background-size: cover; 
            width: 100px; 
            aspect-ratio: 1; 
            border-radius: 50%;"></div>
        <div class="ap_text" contenteditable="true" style="
            display: flex; 
            justify-content: center;
            color: #ffffff;
        ">Bildbeschreibung</div>
    </div>
    </div>

    <script>
        var lastX, line

        const contextMenuListener = (e) => {
            e.preventDefault();

            const greentextContextMenu = document.getElementById('greentextContextMenu');
            greentextContextMenu.style.left = `${e.pageX}px`;
            greentextContextMenu.style.top = `${e.pageY}px`;
            greentextContextMenu.style.display = 'flex';

            line = e.target.closest('div');

            document.addEventListener('mousemove', mouseMover)
            lastX = e.pageX
        };

        const mouseMover = (e) => { 
           
            if (lastX === undefined) {
                return
            }

            const offset = e.pageX - lastX;

            // do not move contextmenu
            if(line.id !== ''){
                return;
            }
            console.log(line)

            let x = line.offsetLeft;

            x += offset;
            line.style.marginLeft = `${x}px`;
            
            lastX = e.pageX;
        }

        
        const greentext = document.getElementById('greentext');
        greentext.addEventListener('contextmenu', contextMenuListener);

        document.addEventListener('click', () => {
            if( !document.getElementById('greentextContextMenu') ){
                return;
            }
            greentextContextMenu.style.display = 'none';
        });

        document.addEventListener('mouseup', (e) => {
            if( e.button === 2 ) {
              document.removeEventListener('mousemove', mouseMover)
            }
        });

        const setColor = (e) => {
            // delete all colorclasses
            const colors = new Set(['tannesand', 'sandtanne', 'kleesand', 'sandklee', 'grastanne', 'tannegras']);
            const classes = line.classList;
            for (let i = 0; i < classes.length; i++) {
                if(!colors.has(classes[i])){
                    continue;
                }
                line.classList.remove(classes[i]);
            }

            line.classList.add(e.target.dataset.setcolor);
        }

        const setSize = (e) => {
            // delete all sizeclasses
            const sizes = new Set(['s', 'm', 'l']);
            const classes = line.classList;
            for (let i = 0; i < classes.length; i++) {
                if(!sizes.has(classes[i])){
                    continue;
                }
                line.classList.remove(classes[i]);
            }

            line.classList.add(e.target.dataset.setsize);
        }
        
        const colorButtons = document.querySelectorAll('[data-setcolor]');
        colorButtons.forEach(btn => {
            btn.addEventListener('click', setColor);
        });

        const sizeButtons = document.querySelectorAll('[data-setsize]');
        sizeButtons.forEach(btn => {
            btn.addEventListener('click', setSize);
        });

        document.querySelectorAll('[contenteditable]').forEach(element => {
            element.addEventListener('blur', () => {
                undo.commit()
            })
        })

        undo.commit()

        config.cockpit = {
            elements: ['download','search','background','copyright','greentext','eyecatcher','addpicture']
        }

    </script>
</div>

<style>
    @font-face {
        font-family: "GrueneType";
        src: url("assets/fonts/GrueneType.woff2") format("woff2");
    }

    .eyecatcher div{
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
    }

    #greentext{
        transform-origin: top left !important;
    }
</style>

<div id="greentextContextMenu">
    <div class="colors">
        <button data-setcolor="tannesand" class="bg-sand"><div data-setcolor="tannesand" class="bg-tanne"></button>
        <button data-setcolor="sandtanne" class="bg-tanne"><div data-setcolor="sandtanne" class="bg-sand"></button>

        <button data-setcolor="kleesand" class="bg-sand"><div data-setcolor="kleesand" class="bg-klee"></button>
        <button data-setcolor="sandklee" class="bg-klee"><div data-setcolor="sandklee" class="bg-sand"></button>

        <button data-setcolor="grastanne" class="bg-tanne"><div data-setcolor="grastanne" class="bg-gras"></button>
        <button data-setcolor="tannegras" class="bg-gras"><div data-setcolor="tannegras" class="bg-tanne"></button>
    </div>
    <div class="sizes">
        <button data-setsize="s" class="s">S</button>
        <button data-setsize="m" class="m">M</button>
        <button data-setsize="l" class="l">L</button>
    </div>
</div>
