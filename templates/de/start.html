<div id="sharepic"
    style="	background-color: #005437;
			background-repeat: no-repeat;
			background-position: 0px 0px; 
			width: 800px; height:800px;
			border:0;
			overflow:hidden;"
    		data-width="800" data-height="800" data-zoom="1" class="selectable" data-cockpit="sharepic">

    <div 
        class="draggable selectable" 
        data-cockpit="greentext"  
        id="greentext"
        contenteditable="true"
    >
        <div class="tannesand">Das hier</div>
        <div class="tannesand"style="margin-left:80px;">ist der neue</div>
        <div class="tannesand">Sharepicgenerator</div>
    </div>

    <div id="greentextContextMenu">
        <button data-setcolor="tannesand" class="tannesand">◉</button>
        <button data-setcolor="sandtanne" class="sandtanne" style="margin-right: 1em">◉</button>

        <button data-setcolor="kleesand" class="kleesand">◉</button>
        <button data-setcolor="sandklee" class="sandklee" style="margin-right: 1em">◉</button>

        <button data-setcolor="grastanne" class="grastanne">◉</button>
        <button data-setcolor="tannegras" class="tannegras">◉</button>

        <div style="flex:1 1 100%"></div>
        <button data-setsize="s" class="">S</button>
        <button data-setsize="m" class="">M</button>
        <button data-setsize="l" class="">L</button>
    </div>

    <div class="draggable selectable" id="logo" 
        data-cockpit="logo" data-clipping="true"
        style="
            width: 400px;
            height: 400px;
            background-image: url('templates/de/logo.svg');
            background-size: contain;
            background-repeat: no-repeat;
            left: -148px;
            top: 359px;
            position: absolute;
        "
    ></div>

    <div    class="eyecatcher draggable selectable" 
            data-cockpit="eyecatcher" 
            id="eyecatcher" 
            contenteditable="true" 
            style="
                z-index:2; 
                left: 12px; top: 260px; 
                font-size: 20px; 
                color: #e9e9e9; 
                background-color: rgb(11, 161, 221);
                width: 100px;
                height: 100px;
                position: absolute;
                left: 400px;
                top: 410px;
            "
    >
        <p>Dienstag</p>
        <p>18 Uhr</p>
    </div>


    <div id="patterns">
        <div    data-id="eyecatcher" 
                data-max="2" 
                data-class="eyecatcher draggable selectable" 
                data-cockpit="eyecatcher" 
                contenteditable="true" 
                style="
                    z-index:2; 
                    left: 12px; top: 260px; 
                    font-size: 20px; 
                    color: #e9e9e9; 
                    background-color: #784ce9;
                    width: 100px;
                    height: 100px;
                "
        >
            <p>MUSTER</p>
        </div>
    
        <div data-class="addpicture draggable selectable" data-id="addpicture" data-cockpit="addpicture" style="display: flex; align-items: center;">
            <div style="background-image: url('templates/mint/tom.jpg');background-size: cover; width: 100px; height: 100px; border-radius: 50%;"></div>
            <div contenteditable="true" style="display: flex; justify-content: center;">Caption</div>
        </div>
    </div>


    <style>
        @font-face {
            font-family: "GrueneType";
            src: url("assets/fonts/GrueneType.woff2") format("woff2");
        }

        #sharepic {
            background-size: cover;
            width: 500px;
            height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            font-family:  "GrueneType", sans-serif;
        }

        #greentext{
            top: 130px; left: 72px; 
            display: flex;
            position: absolute;
            flex-direction: column;
        }

        #greentext div{
            position: relative;
            font-weight: bold;
            margin: 9px 0;
            font-family: "GrueneType", sans-serif;
            z-index: 3;
            font-size: 50px;
            padding: 0;
            line-height: 1em;
            align-self: flex-start;
            white-space: nowrap;
        }

        #greentext div::before {
            content: "";
            position: absolute;
            top: -10px;
            left: -20px;
            transform: skew(-9deg, 0);
            width: calc(100% + 40px);
            height: calc(100% + 18px);
            z-index: -1;
        }

        #greentextContextMenu{
            position: fixed;
            background-color: transparent;
            border: 0;
            color: black;
            display: none;
            z-index: 1000;
            margin-top: 10px;
            flex-direction: row;
            flex-wrap: wrap;
            background-color: rgba(0,0,0,0.4);
            padding: 0.5em;
            border-radius: 10px;
        }

        #greentextContextMenu button{
            background-color: unset;
            font-weight: bold;
            position: relative;
            font-size: 20px;
            line-height: 20px;
            overflow: hidden;
            border-radius: 100px;
            aspect-ratio: 1;
            border: 1px solid white;
        }
        #greentextContextMenu button::before{
            content: "";
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -1;
        }
        #greentextContextMenu button:hover{
            cursor: pointer;
            border-color: black;
        }

        .sandtanne{
            color: #f5f1e9 !important;
        }
        .sandtanne::before{
            background-color: #005437 !important;
        }

        .tannesand{
            color: #005437;
        }
        .tannesand::before{
            background-color: #f5f1e9;
        }

        .kleesand{
            color: #008939;
        }
        .kleesand::before{
            background-color: #f5f1e9;
        }
        .sandklee{
            color: #f5f1e9;
        }
        .sandklee::before{
            background-color: #008939;
        }
        .grastanne{
            color: #8abd24;
        }
        .grastanne::before{
            background-color: #005437;
        }
        .tannegras::before{
            background-color: #005437;
        }
        .tannegras{
            color: #005437;
        }
        .tannegras::before{
            background-color: #8abd24;
        }

        .s{
            zoom: 0.5;
        }

        .m{
            zoom: 1;
        }

        .l{
            zoom: 2;
        }

        .eyecatcher {
            border-radius: 50%;
            transform-origin: 50% 50%;
            rotate: -9deg;
            margin: 0;
            padding: 1em;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .eyecatcher p {
            margin: 0;
            padding: 0;
            line-height: 1em;
            text-align: center;
            font-size: 1.4em;
        }
    </style>



    <script>
        var lastX, line

        const contextMenuListener = (e) => {
            e.preventDefault();

            const greentextContextMenu = document.getElementById('greentextContextMenu');
            greentextContextMenu.style.left = `${e.pageX}px`;
            greentextContextMenu.style.top = `${e.pageY}px`;
            greentextContextMenu.style.display = 'flex';

            line = e.target.closest('div');

            document.addEventListener('mousemove', mouseMover)
            lastX = e.pageX
        };

        const mouseMover = (e) => { 
            if (lastX === undefined) {
                return
            }

            const offset = e.pageX - lastX;

            // do not move contextmenu
            if(line.id !== ''){
                return;
            }

            let x = line.offsetLeft;

            x += offset;
            e.target.closest('div').style.marginLeft = `${x}px`;
            
            lastX = e.pageX;
        }

        
        const greentext = document.getElementById('greentext');
        greentext.addEventListener('contextmenu', contextMenuListener);

        document.addEventListener('click', () => {
            if( !document.getElementById('greentextContextMenu') ){
                return;
            }
            greentextContextMenu.style.display = 'none';
        });

        document.addEventListener('mouseup', (e) => {
            if( e.button === 2 ) {
              document.removeEventListener('mousemove', mouseMover)
            }
        });

        const setColor = (e) => {
            // delete all colorclasses
            const colors = new Set(['tannesand', 'sandtanne', 'kleesand', 'sandklee', 'grastanne', 'tannegras']);
            const classes = line.classList;
            for (let i = 0; i < classes.length; i++) {
                if(!colors.has(classes[i])){
                    continue;
                }
                line.classList.remove(classes[i]);
            }

            line.classList.add(e.target.dataset.setcolor);
        }

        const setSize = (e) => {
            // delete all sizeclasses
            const sizes = new Set(['s', 'm', 'l']);
            const classes = line.classList;
            for (let i = 0; i < classes.length; i++) {
                if(!sizes.has(classes[i])){
                    continue;
                }
                line.classList.remove(classes[i]);
            }

            line.classList.add(e.target.dataset.setsize);
        }
        
        const colorButtons = document.querySelectorAll('[data-setcolor]');
        colorButtons.forEach(btn => {
            btn.addEventListener('mouseover', setColor);
        });

        const sizeButtons = document.querySelectorAll('[data-setsize]');
        sizeButtons.forEach(btn => {
            btn.addEventListener('click', setSize);
        });

        document.getElementById('eyecatcher').addEventListener('input', function(event) {
            var element = event.target;

            const style = window.getComputedStyle(element);
            const max = Math.max(parseFloat(style.width), parseFloat(style.height));

            element.style.width = max + 'px';
            element.style.height = max + 'px';

        });

        document.querySelectorAll('[contenteditable]').forEach(element => {
            element.addEventListener('blur', () => {
                undo.commit()
            })
        })

        undo.commit()

        document.getElementById('eyecatcher_colors').style.display = 'none';


    </script>
</div>